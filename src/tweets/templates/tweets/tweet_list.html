{% extends 'base.html' %}

{% block scripts %}
    <script>
        $(document).ready(function () {
            console.log("working");

            $.ajax({
                // forma de usarlo desde un .js separado
                url:"/api/tweet/",
                //esto funcionaría si se pone directo en el template, si se pusiera en un archivo .js separado
                // YA NO FUNCINARIA, se usaría como se muestra en la asignación a url de arriba.
                //url: "{% url 'tweet-api:list' %}",
                method:"GET",
                success: function (data) {
                    $.each(data, function (key, value) {
                        var tweetKey = key;
                        var tweetContent = value.content;
                        var tweetUser = value.user;
                        $("#tweet-container").append(
                            "<li>" + tweetContent + "<br/> via: " + tweetUser.username  + " | " + "<a href='#'>View</a>" +"</li>"
                        );
                    })
                },
                error: function (data) {
                    console.log("error");
                    console.log(data)
                }

            })


        });
    </script>
{%  endblock scripts %}
{% block content %}
    <div id="tweet-container">

    </div>

    <div class="row">
        <div class="col-sm-3 col-xs-12" style="background-color: red;">
            <h1>
                {{ request.user }}
            </h1>
        </div>
        <div class="col-sm-9">
            {% if not request.GET.q %}
                <div class="">
                    {% include "tweets/form.html" with form=create_form action_url=create_url btn_title="Tweet" %}
                </div>
            {% endif %}
            <hr />
            {% for object in object_list  %}
            <div class="media">
                <div class="media-left">
                    <a href="#">
                        {% if object.image %}
                            <img src="" alt="" class="media-object">
                        {% endif %}
                    </a>
                </div>
                <div class="media-body">
                    {{ object.content }} <br /> Creado por {{  object.user }} | hace: {{ object.timestamp|timesince }}| <a
                        href="{{ object.get_absolute_url }}">Ver</a>
                </div>
            </div>
            <hr />
            {% empty %}
                {% if request.GET.q %}
                    <p>No hay tweets</p>
                {% else %}
                    <p>No tenemos tweets</p>
                {% endif %}
            {% endfor %}
        </div>
    </div>
{% endblock content %}
